# Workers Pool

## Описание проекта

**Workers Pool** — это веб-приложение, разработанное с использованием фреймворка **Quasar** (на базе Vue.js), сборщика **Vite** и менеджера состояний **Pinia**. Проект демонстрирует использование **Web Workers** для выполнения асинхронных задач в пуле воркеров с очередью задач. В приложении реализованы два типа воркеров:

1. **HTTP-воркер**: выполняет HTTP-запросы (GET/POST) к сторонним API с поддержкой базовой аутентификации.
2. **Compute-воркер**: выполняет вычисления (факториал и числа Фибоначчи) в двух реализациях:
   - **JS**: на JavaScript.
   - **Rust**: с использованием WebAssembly, скомпилированного из Rust, для высокой производительности.

Проект демонстрирует управление пулом воркеров, обработку очередей задач, сравнение производительности вычислений на JavaScript и WebAssembly, а также предоставляет интерфейс для настройки воркеров и анализа метрик производительности.

## Технологический стек

- **Quasar Framework** — для создания пользовательского интерфейса на основе Vue.js.
- **Vite** — для быстрой сборки и разработки.
- **Pinia** — для управления состоянием приложения.
- **Web Workers** — для выполнения асинхронных задач в отдельных потоках.
- **WebAssembly (Rust)** — для высокопроизводительных вычислений.
- **Rust + wasm-pack** — для компиляции Rust-кода в WebAssembly.

## Установка и запуск

### Требования

- **Node.js** (версия 16 или выше)
- **Rust** и **wasm-pack** (для компиляции WebAssembly-модуля)
- **NPM** или **Yarn** для управления зависимостями

### Установка зависимостей

1. Склонируйте репозиторий:
   ```bash
   git clone <URL_репозитория>
   cd workers-pool
   ```

2. Установите зависимости проекта:
   ```bash
   npm install
   ```

Пункты 3-7 не обязательны и требуются для компиляции кода Rust. В проект добавлен уже скомпилированный WASM-модуль.

3. Установите Rust и wasm-pack (если еще не установлены):
   ```bash
   curl https://sh.rustup.rs -sSf | sh
   rustup target add wasm32-unknown-unknown
   cargo install wasm-pack
   ```

4. Создайте Rust Library:
   ```bash
   cargo new factorial-wasm --lib
   cd factorial-wasm
   ```

5. Обновите `Cargo.toml`, включив зависимости для обработки больших чисел:
   ```toml
   [package]
   name = "factorial-wasm"
   version = "0.1.0"
   edition = "2021"

   [lib]
   crate-type = ["cdylib"]

   [dependencies]
   wasm-bindgen = "0.2"
   num-bigint = "0.4"
   num-traits = "0.2"
   ```

6. Напишите код Rust в `src/lib.rs` для вычисления факториала и чисел Фибоначчи:
   ```rust
   use num_bigint::BigUint;
   use num_traits::{One, Zero};
   use wasm_bindgen::prelude::*;

   #[wasm_bindgen]
   pub fn factorial(n: u32) -> String {
       let mut result = BigUint::one();
       for i in 1..=n {
           result *= BigUint::from(i);
       }
       result.to_string()
   }

   #[wasm_bindgen]
   pub fn fibonacci(n: u32) -> String {
       if n == 0 {
           return BigUint::zero().to_string();
       }
       let mut a = BigUint::zero();
       let mut b = BigUint::one();
       for _ in 0..n {
           (a, b) = (b.clone(), a + b);
       }
       a.to_string()
   }
   ```

7. Скомпилируйте WebAssembly-модуль:
   ```bash
   cd factorial-wasm
   wasm-pack build --target web
   ```
   Скопируйте файлы `pkg/factorial_wasm.js` и `pkg/factorial_wasm_bg.wasm` в папку `src/workers/wasm/` вашего проекта.

### Запуск проекта

1. Запустите приложение в режиме разработки:
   ```bash
   npm run dev
   ```
   или, если используете Quasar CLI:
   ```bash
   quasar dev
   ```

2. Откройте приложение в браузере по адресу `http://localhost:9000` (порт может варьироваться).

## Использование

Приложение предоставляет три вкладки для взаимодействия с воркерами:

1. **HTTP**:
   - Введите IP/URL, порт, имя пользователя и пароль для выполнения HTTP-запроса.
   - Выберите метод (GET или POST). Для POST-запросов можно указать JSON-тело.
   - Выберите тип воркера (`http` или `all`).
   - Нажмите «Отправить запрос» для выполнения запроса.
   - Результаты отображаются с возможностью фильтрации по типу воркера и очистки.

2. **Compute**:
   - Введите число для вычисления (например, 1000).
   - Выберите тип задачи (`factorial` или `fibonacci`).
   - Выберите тип воркера (`js`, `rust`, или `all`).
   - Нажмите «Выполнить вычисление» для запуска задачи.
   - Результаты включают значение, тип воркера, время выполнения и возможность фильтрации.

3. **Dashboard**:
   - Отображает метрики производительности: среднее время выполнения для каждого типа воркера и задачи.
   - Показывает количество выполненных задач.

### Настройки воркеров

- Нажмите кнопку «Настройки воркеров» для изменения количества воркеров для каждого типа (`http`, `js`, `rust`).
- Минимальное количество воркеров — 1. Попытки установить 0 или отрицательное значение будут скорректированы с уведомлением.
- Если указано более 10 воркеров для одного типа, в консоли появится предупреждение о возможном влиянии на производительность браузера.
- После изменения нажмите «Сохранить» для применения новой конфигурации.

### Подробности воркеров

- В диалоге «Подробности HTTP-воркера» отображается общее количество, свободные и занятые воркеры, а также задачи в очереди.
- В диалоге «Подробности Compute-воркера» дополнительно показывается количество воркеров JS и Rust для большей прозрачности.

## Структура проекта

- `src/pages/IndexPage.vue`: Основной компонент с пользовательским интерфейсом, содержащий вкладки и формы для взаимодействия с воркерами.
- `src/stores/workerStore.js`: Pinia-магазин для управления состоянием воркеров, результатов, конфигурации и метрик.
- `src/workers/`:
   - `httpWorker.js`: Web Worker для HTTP-запросов.
   - `computeWorker.js`: Web Worker для вычислений на JavaScript.
   - `rustComputeWorker.js`: Web Worker для вычислений с использованием WebAssembly.
   - `workerManager.js`: Класс для управления пулом воркеров и очередями задач.
   - `wasm/`: Папка со скомпилированными файлами WebAssembly (`factorial_wasm.js`, `factorial_wasm_bg.wasm`).
- `factorial-wasm/`: Отдельный Rust-проект для компиляции WebAssembly-модуля.
- `README.md`: Документация проекта.

## Примечания

- **Производительность**: Rust Compute-воркер (WASM) обычно быстрее JS Compute-воркера для больших чисел благодаря оптимизациям Rust. Метрики производительности доступны во вкладке Dashboard.
- **Ограничения**: HTTP-воркер требует корректных учетных данных и API, поддерживающего CORS для браузерных запросов.
- **Расширяемость**: Новые типы воркеров или задачи можно добавить, обновив `workerConfig` в `workerStore.js` и соответствующие файлы воркеров.

## Лицензия

Проект распространяется под лицензией MIT. См. файл `LICENSE` для подробностей.